<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Discord All Group Clean-up</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; background: #36393f; color: white; }
        input, button { padding: 10px; margin: 5px 0; border-radius: 4px; border: none; }
        input { width: 400px; background: #40444b; color: white; border: 1px solid #202225; }
        button { background: #ed4245; color: white; cursor: pointer; font-weight: bold; }
        button:disabled { background: #4e5058; cursor: not-allowed; }
        #log { background: #2f3136; padding: 15px; height: 300px; overflow-y: scroll; margin-top: 10px; font-family: monospace; font-size: 12px; border: 1px solid #202225; }
        .success { color: #3ba55c; }
        .error { color: #ed4245; }
        .info { color: #00aff4; }
    </style>
</head>
<body>
    <h2>⚠️ Discord 全グループDM一括離脱ツール</h2>
    <p>このツールは、参加している<strong>すべてのグループDM</strong>から離脱します。（個別DMは消えません）</p>
    
    <div>
        <label>TOKEN:</label><br>
        <input type="password" id="token" placeholder="Authorization Tokenを貼り付け">
    </div>
    <br>
    <button id="startBtn">すべてのグループから離脱を開始</button>

    <div id="log">ログがここに表示されます...</div>

    <script>
        const logDiv = document.getElementById('log');
        const addLog = (msg, className = '') => {
            const div = document.createElement('div');
            div.className = className;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${msg}`;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        document.getElementById('startBtn').addEventListener('click', async () => {
            const token = document.getElementById('token').value.trim();
            if (!token) return alert('トークンを入力してください');
            
            if (!confirm('本当に全てのグループDMから離脱しますか？この操作は取り消せません。')) return;

            document.getElementById('startBtn').disabled = true;

            try {
                addLog('全チャンネル情報を取得中...', 'info');
                const res = await fetch('https://discord.com/api/v9/users/@me/channels', {
                    headers: { 'Authorization': token }
                });

                const channels = await res.json();

                if (!Array.isArray(channels)) {
                    addLog(`❌ エラー: トークンが無効です。(Message: ${channels.message})`, 'error');
                    document.getElementById('startBtn').disabled = false;
                    return;
                }
                
                // type: 3 (グループDM) のみを抽出
                const targets = channels.filter(c => c.type === 3);
                addLog(`グループDMを ${targets.length
